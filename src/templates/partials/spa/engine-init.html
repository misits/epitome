<script type="module">
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // Import the engine and utilities from the main module
            const module = await import('./assets/js/main.js');
            const { EpitomeSPA } = module;
            
            const container = document.getElementById('app-container');
            const debug = container.getAttribute('data-debug-mode') === 'true';
            
            // Create engine instance
            const engine = new EpitomeSPA({
                containerId: 'app-container',
                initialScene: 'index',
                scenesPath: 'assets/data/scenes.json',
                debugMode: debug
            });
            
            // Reset button
            var resetBtn = document.getElementById('reset-button');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (confirm('Reset your progress?')) {
                        engine.resetState();
                    }
                });
            }
            
            // Animation toggle
            var animBtn = document.getElementById('toggle-animations');
            if (animBtn) {
                // Update button text based on current animation state
                const updateAnimationToggleUI = () => {
                    const isEnabled = engine.getAnimations();
                    animBtn.innerHTML = `<span class="toggle-animations-status">${isEnabled ? '✓' : '✗'}</span> Animations`;
                };
                
                // Set initial UI state
                updateAnimationToggleUI();
                
                // Add click handler
                animBtn.addEventListener('click', function() {
                    // Use the proper engine method to toggle animations
                    engine.setAnimations(!engine.getAnimations());
                    // Update UI
                    updateAnimationToggleUI();
                });
            }
            
            // Debug access
            window.gameEngine = engine;
        } catch (error) {
            console.error('Failed to initialize SPA engine:', error);
            document.getElementById('app-container').innerHTML = 
                `<div class="scene-error" style="color:red;padding:20px;text-align:center">
                    <h2>Error</h2>
                    <p>Failed to initialize: ${error.message}</p>
                </div>`;
        }
    });
</script> 